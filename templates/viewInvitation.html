<script type="text/JavaScript" src="../media/jquery-3.3.1.min.js"></script>
{{template "test.html" .}}
{{define "body"}}

<script>
  function adjustArrows() {
    $(".listUpArrow img").show();
    $(".listUpArrow img:first").hide();
    $(".listDownArrow img").show();
    $(".listDownArrow img:last").hide();
  }

  function togglePersonalInfo(encodedKey) {
    $("#" + encodedKey).toggle();
    if ($("#" + encodedKey).is(":visible")) $("#showInfo_" + encodedKey).text("Hide"); 
    else {
      $("#showInfo_" + encodedKey).text("Edit Personal Info"); 
    }
  }

  $( document ).ready(function() {
    adjustArrows();

    $(".listUpArrow, .listDownArrow").click(function() {
      var row = $(this).closest('tr');
      if ($(this).hasClass('listUpArrow'))
        row.prev().before(row);
      else
        row.next().after(row);

      adjustArrows();
    });

  })
</script>
<a href="invitations">All Invitations</a>

<h1>Invitation for {{with .Invitation}}{{.Event.ShortName}}{{end}}</h1>
<form action="saveInvitation" method="POST">
  <input type="hidden" name="invitation" value="{{with .Invitation}}{{.EncodedKey}}{{end}}">
  <table class="inviteeTable">
    {{$Invitation := .Invitation}}
    {{$FormInfoMap := .FormInfoMap}}
    {{$AllRsvpStatuses := .AllRsvpStatuses}}
    {{range .Invitation.Invitees}}
       {{$invitee := .}}
       <tr><td class="listUpArrow"><img class="hidden" src="../media/arrow.png"></td>
           <td class="listDownArrow"><img class="hidden" src="../media/arrow.png"></td>
           <td>
	     {{$RsvpStatus := (index $Invitation.RsvpMap $invitee.Key)}}
             <span class="invitationPersonHeading">{{.Person.FullName}}</span>
	     <select>
	       {{if not $RsvpStatus.ShortDescription}}<option value="-1" selected>Will you be joining us?</option>{{end}}
	       {{range $Invitation.Event.RsvpStatuses}}
	         <option value="{{.}}"
                   {{if and $RsvpStatus.ShortDescription (eq $RsvpStatus.Status .)}}selected{{end}}
                 >{{(index $AllRsvpStatuses .).LongDescription}}</option>
	       {{end}}
	     </select>

        <div class="invitationPersonalInfoLink"><a onclick="togglePersonalInfo('{{.Key}}')"><span id="showInfo_{{.Key}}">Edit Personal Info</span></a></div>

             <input type="hidden" name="person" value="{{.Key}}">
	     <div id="{{.Key}}" style="display:none">
{{template "updatePersonForm" (index $FormInfoMap .Person.DatastoreKey)}}
</div>
           </td>
       </tr>
    {{end}}
  </table>
  <input type="submit" value="Save">

</form>
{{end}}
